<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Inscripciones</title>

<style>
  body{
    font-family: Arial, sans-serif;
    background:#ffffff;
    color:#000000;
    margin:20px;
  }

  h1{ margin:0 0 5px; }

  .panel{
    max-width:1400px;
    margin:auto;
  }

  .filters{
    display:grid;
    grid-template-columns:repeat(5,minmax(0,1fr));
    gap:10px;
    margin-bottom:15px;
  }

  .filters label{
    font-size:13px;
    display:block;
    margin-bottom:4px;
  }

  select,input,button{
    width:100%;
    padding:6px 8px;
    border:1px solid #ccc;
    border-radius:6px;
    background:#fff;
    color:#000;
  }

  button{ cursor:pointer; }

  .summary{
    padding:6px 8px;
    border:1px solid #ccc;
    border-radius:6px;
    font-size:13px;
  }

  .tablewrap{
    overflow:auto;
    border:1px solid #ccc;
  }

  table{
    width:100%;
    border-collapse:collapse;
    table-layout:fixed;
  }

  th,td{
    padding:8px;
    border-bottom:1px solid #ddd;
    font-size:13px;
    vertical-align:top;
  }

  th{
    background:#f5f5f5;
    text-align:left;
  }

  td.num, th.num{
    text-align:right;
  }

  td.wrap{
    white-space:normal;
    word-break:break-word;
  }

  .badge{
    background:#f0f0f0;
    padding:2px 6px;
    border-radius:4px;
    display:inline-block;
  }

  .barbg{
    height:8px;
    background:#e5e5e5;
    border-radius:4px;
    overflow:hidden;
  }

  .bar{
    height:100%;
    background:#4CAF50;
  }

  .dot{
    display:inline-block;
    width:8px;
    height:8px;
    border-radius:50%;
    margin-right:6px;
  }

  .g{background:#4CAF50;}
  .y{background:#f4b400;}
  .r{background:#d93025;}
  .s{background:#999;}

</style>
</head>

<body>

<div class="panel">
  <h1>Visualizador de Inscripciones</h1>

  <div class="filters">
    <div>
      <label>Día</label>
      <select id="fDia"><option value="">Todos</option></select>
    </div>
    <div>
      <label>Horario</label>
      <select id="fHorario"><option value="">Todos</option></select>
    </div>
    <div>
      <label>Sede</label>
      <select id="fSede"><option value="">Todas</option></select>
    </div>
    <div>
      <label>Comisión</label>
      <select id="fArea"><option value="">Todas</option></select>
    </div>
    <div>
      <label>Resumen</label>
      <div id="summary" class="summary">—</div>
    </div>
  </div>

  <div class="tablewrap">
    <table>
      <thead>
        <tr>
          <th>Día</th>
          <th>Fecha</th>
          <th>Horario</th>
          <th>Sede</th>
          <th>Comisión</th>
          <th class="num">Cupo</th>
          <th class="num">Inscr.</th>
          <th>%</th>
          <th>Ocupación</th>
        </tr>
      </thead>
      <tbody id="tbody">
        <tr><td colspan="9">Cargando...</td></tr>
      </tbody>
    </table>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
<script>

const csvUrl = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQ2avA92LvHh37HuCigjLogbT2hhoLprim9OJu7tI9Do2jU6u1hnEsrMov5UKpJHqNcx9fNESB2W3d4/pub?output=csv";

const $ = id => document.getElementById(id);

function pick(row, name){
  return row[name] ?? "";
}

function toNumber(x){
  const n = Number(String(x).replace(",",".").replace("%",""));
  return Number.isFinite(n) ? n : NaN;
}

function pctFrom(row){
  const cupo = toNumber(row["Cupo"]);
  const ins  = toNumber(row["# Inscr."]);
  if (Number.isFinite(cupo) && cupo>0 && Number.isFinite(ins))
    return (ins/cupo)*100;
  return NaN;
}

function occ(p){
  if (!Number.isFinite(p)) return {dot:"s",bar:0,label:"—"};
  if (p>=100) return {dot:"r",bar:100,label:"Lleno"};
  if (p>=85) return {dot:"r",bar:p,label:"Alta"};
  if (p>=50) return {dot:"y",bar:p,label:"Media"};
  return {dot:"g",bar:p,label:"Baja"};
}

let rowsAll = [];

function render(rows){
  const tb = $("tbody");
  let sumC=0, sumI=0;

  tb.innerHTML = rows.map(r=>{
    const p = pctFrom(r);
    const o = occ(p);
    const cupo = toNumber(r["Cupo"]);
    const ins  = toNumber(r["# Inscr."]);

    if(Number.isFinite(cupo)) sumC+=cupo;
    if(Number.isFinite(ins)) sumI+=ins;

    return `
    <tr>
      <td>${r["Dia"]||""}</td>
      <td>${r["Fecha"]||""}</td>
      <td>${r["Horario"]||""}</td>
      <td class="wrap"><span class="badge">${r["Sede"]||""}</span></td>
      <td class="wrap"><span class="badge">${r["Área"]||r["Area"]||""}</span></td>
      <td class="num">${cupo||""}</td>
      <td class="num">${ins||""}</td>
      <td><span class="dot ${o.dot}"></span>${Number.isFinite(p)?p.toFixed(0)+"%":""}</td>
      <td>
        <div class="barbg"><div class="bar" style="width:${o.bar}%"></div></div>
      </td>
    </tr>`;
  }).join("");

  const pctTotal = sumC>0 ? (sumI/sumC)*100 : NaN;
  $("summary").textContent =
    rows.length + " filas · " + sumI + " inscripciones · " + sumC +
    " cupos · " + (Number.isFinite(pctTotal)?pctTotal.toFixed(0)+"%":"");
}

function load(){
  Papa.parse(csvUrl,{
    download:true,
    header:true,
    skipEmptyLines:true,
    complete:(res)=>{
      rowsAll = res.data;

      rowsAll.sort((a,b)=>{
        return (a["Dia"]||"").localeCompare(b["Dia"]||"")
          || (a["Horario"]||"").localeCompare(b["Horario"]||"")
          || (a["Sede"]||"").localeCompare(b["Sede"]||"");
      });

      render(rowsAll);
    }
  });
}

load();

</script>

</body>
</html>
